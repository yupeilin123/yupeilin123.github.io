<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>青蛙蛤蟆兽</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2019-02-11T07:14:18.595Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>yupeilin</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Koa系列-Templating：koa-views</title>
    <link href="http://yoursite.com/2019/02/11/koa-views/"/>
    <id>http://yoursite.com/2019/02/11/koa-views/</id>
    <published>2019-02-11T06:54:06.000Z</published>
    <updated>2019-02-11T07:14:18.595Z</updated>
    
    <content type="html"><![CDATA[<p>这个中间件用于模板渲染，以包 <code>consolidate</code> 为默认的渲染引擎集合包，支持多种不同模板引擎。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 参数设置以及视图的地址，必须使用绝对地址</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">viewsMiddleware</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  path,</span></span></span><br><span class="line"><span class="function"><span class="params">  &#123; engineSource = consolidate, extension = <span class="string">'html'</span>, options = &#123;&#125;, map &#125; = &#123;&#125; </span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">views</span>(<span class="params">ctx,next</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 判断是否存在render函数，有则跳过后续代码</span></span><br><span class="line">    <span class="keyword">if</span>(ctx.render) <span class="keyword">return</span> next()</span><br><span class="line">    ctx.response.render = ctx.render = <span class="function"><span class="keyword">function</span>(<span class="params">relaPath,locals = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 包get-paths用来得到模板引擎视图的绝对路径</span></span><br><span class="line">      <span class="keyword">return</span> getPaths(path, relaPath, extension).then(<span class="function"><span class="params">paths</span> =&gt;</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>之后就来决定是使用 <code>send</code> 返回默认 <code>.html</code> 文件还是需要使用模板引擎。</p><p>有个小细节就是，是否需要美化代码，是通过 <code>locals.pretty</code> 判断。</p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;这个中间件用于模板渲染，以包 &lt;code&gt;consolidate&lt;/code&gt; 为默认的渲染引擎集合包，支持多种不同模板引擎。&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td
        
      
    
    </summary>
    
      <category term="Koa" scheme="http://yoursite.com/categories/Koa/"/>
    
    
      <category term="koa" scheme="http://yoursite.com/tags/koa/"/>
    
  </entry>
  
  <entry>
    <title>Koa系列-Services：koa-orm</title>
    <link href="http://yoursite.com/2019/01/30/koa/koa-orm/"/>
    <id>http://yoursite.com/2019/01/30/koa/koa-orm/</id>
    <published>2019-01-30T02:25:19.000Z</published>
    <updated>2019-01-30T03:02:27.963Z</updated>
    
    <content type="html"><![CDATA[<p>主要通过 <code>sequelize</code> 和 <code>squel</code> 来操作数据库。</p><p>参数 <code>configs</code> 可以是object或者是array，也就是可以有多个database实例。</p><p><code>configs</code> 有一个属性是 <code>modelPath</code> ,用来导入 <code>model</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">sequelize, modelPath</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> models = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Bootstrap models</span></span><br><span class="line">  fs.readdirSync(modelPath) <span class="comment">// 得是个文件夹，应该需要判断</span></span><br><span class="line">    .forEach(<span class="function"><span class="keyword">function</span>(<span class="params">file</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="regexp">/\.js$/</span>.test(file)) &#123;</span><br><span class="line">        <span class="keyword">const</span> model = sequelize.import(join(modelPath, file));</span><br><span class="line">        models[model.name] = model;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">Object</span>.keys(models).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">modelName</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (models[modelName].associate) &#123;</span><br><span class="line">      models[modelName].associate(models);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> models;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>最后导出 <code>database</code> ，挂载到 <code>ctx.orm</code> 上。</p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;主要通过 &lt;code&gt;sequelize&lt;/code&gt; 和 &lt;code&gt;squel&lt;/code&gt; 来操作数据库。&lt;/p&gt;
&lt;p&gt;参数 &lt;code&gt;configs&lt;/code&gt;
        
      
    
    </summary>
    
      <category term="Koa" scheme="http://yoursite.com/categories/Koa/"/>
    
    
      <category term="koa" scheme="http://yoursite.com/tags/koa/"/>
    
  </entry>
  
  <entry>
    <title>Koa系列-Caching：koa-etag</title>
    <link href="http://yoursite.com/2019/01/20/koa/koa-etag/"/>
    <id>http://yoursite.com/2019/01/20/koa/koa-etag/</id>
    <published>2019-01-20T07:25:34.000Z</published>
    <updated>2019-01-30T02:27:57.278Z</updated>
    
    <content type="html"><![CDATA[<p>有以下几种情况不能使用 <code>etag</code>：</p><p>1.没有响应实体<br>2.已设置了 <code>etag</code><br>3.http状态码不是 <code>2xx</code><br>4.响应实体是 <code>stream</code> 类型，没有具体路径也不行</p><p>最后是使用了包 <code>etag</code> 生成具体的 <code>etag</code></p><p>参考: <a href="https://www.cnblogs.com/etoah/p/5579622.html" target="_blank" rel="noopener">浏览器缓存</a></p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;有以下几种情况不能使用 &lt;code&gt;etag&lt;/code&gt;：&lt;/p&gt;
&lt;p&gt;1.没有响应实体&lt;br&gt;2.已设置了 &lt;code&gt;etag&lt;/code&gt;&lt;br&gt;3.http状态码不是 &lt;code&gt;2xx&lt;/code&gt;&lt;br&gt;4.响应实体是
        
      
    
    </summary>
    
      <category term="Koa" scheme="http://yoursite.com/categories/Koa/"/>
    
    
      <category term="koa" scheme="http://yoursite.com/tags/koa/"/>
    
  </entry>
  
  <entry>
    <title>Koa系列-Compression：koa-compress</title>
    <link href="http://yoursite.com/2019/01/18/koa/koa-compress/"/>
    <id>http://yoursite.com/2019/01/18/koa/koa-compress/</id>
    <published>2019-01-18T03:18:29.000Z</published>
    <updated>2019-01-20T07:25:54.493Z</updated>
    
    <content type="html"><![CDATA[<p>使用该库进行压缩，有以下几个条件，若哪一条不能通过，则不需要进行压缩。</p><p>1.必须得有 <code>body</code><br>2.响应头是否已经发送或者响应是否已经结束<br>3.是否设置了 <code>compress = false</code><br>4.请求方法不能是 <code>HEAD</code><br>5.判断状态码是否不能包含消息体<br>6.响应头是否已经存在 <code>Content-Encoding</code><br>7.筛选响应体的类型<br>8.是否可以设置 <code>acceptsEncodings(&#39;gzip&#39;,&#39;deflate&#39;,&#39;identity&#39;)</code><br>9.内容编码为 <code>identity</code><br>10.响应内容大小是否小与设置值</p><p>最后即使用 <code>gzip</code> or <code>defalte</code> 进行压缩传输。</p><p>参考：<a href="https://blog.csdn.net/u014569188/article/details/78912446" target="_blank" rel="noopener">http协议中的Content-Encoding</a></p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;使用该库进行压缩，有以下几个条件，若哪一条不能通过，则不需要进行压缩。&lt;/p&gt;
&lt;p&gt;1.必须得有 &lt;code&gt;body&lt;/code&gt;&lt;br&gt;2.响应头是否已经发送或者响应是否已经结束&lt;br&gt;3.是否设置了 &lt;code&gt;compress =
        
      
    
    </summary>
    
      <category term="Koa" scheme="http://yoursite.com/categories/Koa/"/>
    
    
      <category term="koa" scheme="http://yoursite.com/tags/koa/"/>
    
  </entry>
  
  <entry>
    <title>Koa系列-JSON and JSONP Responses：koa-response-jsop</title>
    <link href="http://yoursite.com/2019/01/17/koa/koa-response-jsop/"/>
    <id>http://yoursite.com/2019/01/17/koa/koa-response-jsop/</id>
    <published>2019-01-17T03:21:55.000Z</published>
    <updated>2019-01-17T03:34:27.294Z</updated>
    
    <content type="html"><![CDATA[<p>这个库的具体实现是将koa实例传入函数jsonp，在contenxt上挂载一个新函数jsonp，来达到效果。</p><p>参考：<a href="https://segmentfault.com/a/1190000009742074" target="_blank" rel="noopener">jsonp原理</a></p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;这个库的具体实现是将koa实例传入函数jsonp，在contenxt上挂载一个新函数jsonp，来达到效果。&lt;/p&gt;
&lt;p&gt;参考：&lt;a href=&quot;https://segmentfault.com/a/1190000009742074&quot; target=&quot;_blank&quot;
        
      
    
    </summary>
    
      <category term="Koa" scheme="http://yoursite.com/categories/Koa/"/>
    
    
      <category term="koa" scheme="http://yoursite.com/tags/koa/"/>
    
  </entry>
  
</feed>
